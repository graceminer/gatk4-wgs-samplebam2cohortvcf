The flag 'directory' used in rule base_recalibrator_report is only valid for outputs, not inputs.
The flag 'directory' used in rule apply_bqsr is only valid for outputs, not inputs.
Building DAG of jobs...
Job counts:
	count	jobs
	2	check_fingerprint
	2	check_prevalidation
	2	collect_raw_wgs_metrics
	2	collect_wgs_metrics
	2	convert_to_cram
	1	main
	2	validate_cram
	13

[Wed Jan 19 23:35:07 2022]
rule check_fingerprint:
    input: output/final_bam/1102781231.final.bam
    output: output/final_bam/1102781231.final_bam.fingerprinting_detail_metrics, output/final_bam/1102781231.final_bam.fingerprinting_summary_metrics
    jobid: 5
    benchmark: benchmarks/final_bam/1102781231.check_fingerprint.txt
    wildcards: sample=1102781231


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3

        java -Dsamjdk.buffer_size=131072           -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10 -Xms2g            -jar $PICARD           CheckFingerprint           INPUT=output/final_bam/1102781231.final.bam           SUMMARY_OUTPUT=output/final_bam/1102781231.final_bam.fingerprinting_summary_metrics           DETAIL_OUTPUT=output/final_bam/1102781231.final_bam.fingerprinting_detail_metrics           GENOTYPES=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/NA12878_NA12878.hg38.reference.fingerprint.vcf           HAPLOTYPE_MAP=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/references-hg38-v0-Homo_sapiens_assembly38.haplotype_database.txt           SAMPLE_ALIAS="1102781231"           IGNORE_READ_GROUPS=true
        

[Wed Jan 19 23:35:07 2022]
rule collect_wgs_metrics:
    input: output/final_bam/1102781231.final.bam
    output: output/final_bam/1102781231.final_bam.wgs_metrics
    jobid: 7
    benchmark: benchmarks/final_bam/1102781231.final_bam.wgs_metrics.txt
    wildcards: sample=1102781231


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3

        java -Xms2000m -jar $PICARD           CollectWgsMetrics           INPUT=output/final_bam/1102781231.final.bam           VALIDATION_STRINGENCY=SILENT           REFERENCE_SEQUENCE=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-Homo_sapiens_assembly38.fasta           INCLUDE_BQ_HISTOGRAM=true           INTERVALS=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-wgs_calling_regions.hg38.interval_list           OUTPUT=output/final_bam/1102781231.final_bam.wgs_metrics           USE_FAST_ALGORITHM=true           READ_LENGTH=250
        

[Wed Jan 19 23:35:07 2022]
rule check_fingerprint:
    input: output/final_bam/1102777134.final.bam
    output: output/final_bam/1102777134.final_bam.fingerprinting_detail_metrics, output/final_bam/1102777134.final_bam.fingerprinting_summary_metrics
    jobid: 9
    benchmark: benchmarks/final_bam/1102777134.check_fingerprint.txt
    wildcards: sample=1102777134


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3

        java -Dsamjdk.buffer_size=131072           -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10 -Xms2g            -jar $PICARD           CheckFingerprint           INPUT=output/final_bam/1102777134.final.bam           SUMMARY_OUTPUT=output/final_bam/1102777134.final_bam.fingerprinting_summary_metrics           DETAIL_OUTPUT=output/final_bam/1102777134.final_bam.fingerprinting_detail_metrics           GENOTYPES=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/NA12878_NA12878.hg38.reference.fingerprint.vcf           HAPLOTYPE_MAP=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/references-hg38-v0-Homo_sapiens_assembly38.haplotype_database.txt           SAMPLE_ALIAS="1102777134"           IGNORE_READ_GROUPS=true
        

[Wed Jan 19 23:35:07 2022]
rule collect_wgs_metrics:
    input: output/final_bam/1102777134.final.bam
    output: output/final_bam/1102777134.final_bam.wgs_metrics
    jobid: 11
    benchmark: benchmarks/final_bam/1102777134.final_bam.wgs_metrics.txt
    wildcards: sample=1102777134


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3

        java -Xms2000m -jar $PICARD           CollectWgsMetrics           INPUT=output/final_bam/1102777134.final.bam           VALIDATION_STRINGENCY=SILENT           REFERENCE_SEQUENCE=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-Homo_sapiens_assembly38.fasta           INCLUDE_BQ_HISTOGRAM=true           INTERVALS=/sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-wgs_calling_regions.hg38.interval_list           OUTPUT=output/final_bam/1102777134.final_bam.wgs_metrics           USE_FAST_ALGORITHM=true           READ_LENGTH=250
        

[Wed Jan 19 23:35:07 2022]
rule check_prevalidation:
    input: output/final_bam/1102781231.final_bam.collect_aggregated_metrics.alignment_summary_metrics
    output: output/final_cram/1102781231.final_cram.duplication.csv, output/final_cram/1102781231.final_cram.chimerism.csv
    jobid: 13
    benchmark: benchmarks/final_cram/1102781231.check_prevalidation.txt
    wildcards: sample=1102781231


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3

        set -o pipefail
        set -e

        grep -A 1 PERCENT_DUPLICATION output/duplicates_marked/1102781231/1102781231.aligned.unsorted.duplicates_marked.duplicate_metrics > output/final_cram/1102781231.final_cram.duplication.csv
        grep -A 3 PCT_CHIMERAS output/final_bam/1102781231.final_bam.collect_aggregated_metrics.alignment_summary_metrics | grep -v OF_PAIR > output/final_cram/1102781231.final_cram.chimerism.csv

        python <<CODE

import csv
with open('output/final_cram/1102781231.final_cram.duplication.csv') as dupfile:
  reader = csv.DictReader(dupfile, delimiter='	')
  for row in reader:
    with open("duplication_value.txt","w") as file:
      file.write(row['PERCENT_DUPLICATION'])
      file.close()

with open('output/final_cram/1102781231.final_cram.chimerism.csv') as chimfile:
  reader = csv.DictReader(chimfile, delimiter='	')
  for row in reader:
    with open("chimerism_value.txt","w") as file:
      file.write(row['PCT_CHIMERAS'])
      file.close()
CODE

        

[Wed Jan 19 23:35:07 2022]
rule convert_to_cram:
    input: output/final_bam/1102781231.final.bam
    output: output/final_cram/1102781231.final.cram, output/final_cram/1102781231.final.cram.md5
    jobid: 19
    benchmark: benchmarks/final_cram/1102781231.final.cram.txt
    wildcards: sample=1102781231


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3 samtools/1.9
        set -e
        set -o pipefail

        samtools view -C -T /sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-Homo_sapiens_assembly38.fasta output/final_bam/1102781231.final.bam |         tee output/final_cram/1102781231.final.cram |         md5sum | awk '{print $1}' > output/final_cram/1102781231.final.cram.md5

        # Create REF_CACHE. Used when indexing a CRAM
        seq_cache_populate.pl -root ./ref/cache /sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-Homo_sapiens_assembly38.fasta
        export REF_PATH=:
        export REF_CACHE=./ref/cache/%2s/%2s/%s

        samtools index output/final_cram/1102781231.final.cram
        
        

[Wed Jan 19 23:35:07 2022]
rule check_prevalidation:
    input: output/final_bam/1102777134.final_bam.collect_aggregated_metrics.alignment_summary_metrics
    output: output/final_cram/1102777134.final_cram.duplication.csv, output/final_cram/1102777134.final_cram.chimerism.csv
    jobid: 15
    benchmark: benchmarks/final_cram/1102777134.check_prevalidation.txt
    wildcards: sample=1102777134


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3

        set -o pipefail
        set -e

        grep -A 1 PERCENT_DUPLICATION output/duplicates_marked/1102777134/1102777134.aligned.unsorted.duplicates_marked.duplicate_metrics > output/final_cram/1102777134.final_cram.duplication.csv
        grep -A 3 PCT_CHIMERAS output/final_bam/1102777134.final_bam.collect_aggregated_metrics.alignment_summary_metrics | grep -v OF_PAIR > output/final_cram/1102777134.final_cram.chimerism.csv

        python <<CODE

import csv
with open('output/final_cram/1102777134.final_cram.duplication.csv') as dupfile:
  reader = csv.DictReader(dupfile, delimiter='	')
  for row in reader:
    with open("duplication_value.txt","w") as file:
      file.write(row['PERCENT_DUPLICATION'])
      file.close()

with open('output/final_cram/1102777134.final_cram.chimerism.csv') as chimfile:
  reader = csv.DictReader(chimfile, delimiter='	')
  for row in reader:
    with open("chimerism_value.txt","w") as file:
      file.write(row['PCT_CHIMERAS'])
      file.close()
CODE

        

[Wed Jan 19 23:35:07 2022]
rule convert_to_cram:
    input: output/final_bam/1102777134.final.bam
    output: output/final_cram/1102777134.final.cram, output/final_cram/1102777134.final.cram.md5
    jobid: 20
    benchmark: benchmarks/final_cram/1102777134.final.cram.txt
    wildcards: sample=1102777134


        module load R/3.5.3  gatk/4.2.0.0 java/1.8.0_211 python/3.7.3 picard/2.22.3 samtools/1.9
        set -e
        set -o pipefail

        samtools view -C -T /sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-Homo_sapiens_assembly38.fasta output/final_bam/1102777134.final.bam |         tee output/final_cram/1102777134.final.cram |         md5sum | awk '{print $1}' > output/final_cram/1102777134.final.cram.md5

        # Create REF_CACHE. Used when indexing a CRAM
        seq_cache_populate.pl -root ./ref/cache /sc/arion/projects/MMAAAS/src/gatk-resources/hg38_20201116/hg38/v0/resources-broad-hg38-v0-Homo_sapiens_assembly38.fasta
        export REF_PATH=:
        export REF_CACHE=./ref/cache/%2s/%2s/%s

        samtools index output/final_cram/1102777134.final.cram
        
        

[Wed Jan 19 23:35:07 2022]
rule collect_raw_wgs_metrics:
    input: output/final_bam/1102781231.final.bam
    output: output/final_bam/1102781231.final_bam.raw_wgs_metrics
    jobid: 8
    benchmark: benchmarks/final_bam/1102781231.final_bam.raw_wgs_metrics.txt
    wildcards: sample=1102781231

RuleException in line 356 of /sc/arion/projects/MMAAAS/ngs_res/aaa_pilot_20201113/gatk20220113/snakefilecurrent:
NameError: The name 'java_memory_size' is unknown in this context. Please make sure that you defined that variable. Also note that braces not used for variable access have to be escaped by repeating them, i.e. {{print $1}}
  File "/hpc/packages/minerva-centos7/py_packages/3.7/lib/python3.7/site-packages/snakemake/executors/__init__.py", line 133, in run_jobs
  File "/hpc/packages/minerva-centos7/py_packages/3.7/lib/python3.7/site-packages/snakemake/executors/__init__.py", line 138, in run
  File "/hpc/packages/minerva-centos7/py_packages/3.7/lib/python3.7/site-packages/snakemake/executors/__init__.py", line 149, in _run
  File "/hpc/packages/minerva-centos7/py_packages/3.7/lib/python3.7/site-packages/snakemake/executors/__init__.py", line 169, in printjob
  File "/hpc/packages/minerva-centos7/py_packages/3.7/lib/python3.7/site-packages/snakemake/executors/__init__.py", line 155, in printjob
